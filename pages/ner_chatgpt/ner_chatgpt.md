# NER с использованием ChatGPT

![Да-да-да. Я сгенерил эту картинку с помощью AI](picture.jpg)

Подкинул мне как-то коллега-товарищ идею делать NER (named entities recognition) используя GPT-3.5 (УТОЧНИТЬ ВЕРСИЮ ГПТ СЕТИ) нейронку. Я подумал и решил, чего нет когда да?
Сейчас расскажу о моих результатах эксперимента.

## Постановка задачи
Сделать распознование адресов, имен организаций, номеров телефонов, товаров в тексте и представить их в формате понятном для компьюета. Под "понятный для компьютера" так-же имеется в виду, что нам не нужен человек, который будет валидировать ответы GPT сети.

Адреса нам интересно разобрать на следующие компоненты: страна, регион, район, улица, номер дома.

Для товаров мы будем искать: название, цену, категорию, примечания.

Имена организаций и номера телефонов будем просто собирать как строки.

В качестве формата возьмем JSON. Ну а что вы еще ожидали от жаваскрипт-писателя со стажем?

Обращу внимание, что для каждого запроса на разбор я создаю новый контекст, чтобы предыдущий не влиял на ответ.

## Пробуем найти имена организаций

С футера сайта своей альма-матер я взял контактную иформацию. Она сама по себе имеет не много шума, но и не имеет строгой структуры. Над этим семплом текста я и буду эксперементировать.

```
ул. Чехова, 2, ауд. И-201
г. Таганрог, 347922, Ростовская область, Россия

Телефон: 8 (8634) 360-450

E-Mail: info@ictis.sfedu.ru

Ответственный за сайт: --- ---
Сайт разработан Студенческим конструкторским бюро
"Компьютерное инновационное творчество" ИКТИБ

© 2015-2023, Институт компьютерных технологий и информационной безопасности ИТА ЮФУ
```

Попробуем сформулировать запрос "в лоб".

```
Распознай имена организаций и дай ответ в формате json

<sample_text>
```

GPT сеть пошуршала матрицами и выдала нам следующее:

```json
{
  "организации": [
    "Институт компьютерных технологий и информационной безопасности ИТА ЮФУ",
    "Студенческое конструкторское бюро 'Компьютерное инновационное творчество' ИКТИБ"
  ]
}
```

Как видим, нейронка не плохо справилась с распознованием, но ключи на кириллице не прикольно. Я усовершенствовал свой запрос до

```
Распознай имена организаций и дай ответ в формате json {"organizations":["organization name"]}

<sample_text>
```

Вот! Теперь ключ в нужном формате, но json явно не валидный. Я пробовал разные варианты промтов, но мне так и не удалось заставить его дать мне верный ответ с первого промта в контексте.

```json
{
  "organizations": [
    "Институт компьютерных технологий и информационной безопасности ИТА ЮФУ",
    "Студенческое конструкторское бюро "Компьютерное инновационное творчество" ИКТИБ"
  ]
}
```

В том же контексте я попросил его исправить json и что вы думаете?! Таки исправил! Но я считаю, что это не удовлетворительно, потому что это может выстрелить в любой момент.

Просил его исправить, дав ему на вход следующий промт:

```
Сейчас строки в массиве имеют неверный формат. Исправь их
```

Ответ, который я получил от нейронки.
```json
{
  "organizations": [
    "Институт компьютерных технологий и информационной безопасности ИТА ЮФУ",
    "Студенческое конструкторское бюро \"Компьютерное инновационное творчество\" ИКТИБ"
  ]
}
```

## Номера телефонов

Имея накопленный опыт, попробуем распознать номера телефонов в тексте. Промт я соформировал такой

```
Распознай в тексте номера телефонов. Ответ дай в формате ["phone number"]

<sample_text>
```

После непродолжительного шуршания я получил ответ:

```json
["8 (8634) 360-450"]
```

PROFIT! Как бы да, но нет. В процессе написания этой статьи во всех моих запросах мне удавалось распознать номера телефонов с разной степенью успешности, но ранее мне я воспроизводил ситуацию, когда GPT отказывался распозновать номера, ссылаясть на то, что не хочет распозновать персональные данные и все такое. Это тоже стоит учитывать.

## Адреса

Попробую разобрать более сложную структуру. Для начала я попробовал бросить все "на самотек" то есть дать GPT самой определиться с структурой.

```
Найди  в тексте географические адреса и разбей их на отдельные компоненты. Ответ дай в формате json

<sample_text>
```

Ответ оказался несколько избыточным, но адрес распознался великолепно. JSON не валидный - потрачено.

```json
{
  "address": {
    "street": "ул. Чехова",
    "house_number": "2",
    "room": "ауд. И-201",
    "city": "Таганрог",
    "postal_code": "347922",
    "region": "Ростовская область",
    "country": "Россия"
  },
  "phone": "8 (8634) 360-450",
  "email": "info@ictis.sfedu.ru",
  "website_responsible": "--- ---",
  "website_developed_by": "Студенческое конструкторское бюро "Компьютерное инновационное творчество" ИКТИБ",
  "copyright": "© 2015-2023, Институт компьютерных технологий и информационной безопасности ИТА ЮФУ"
}
```

Конкретизируем свои хотелки, попробуем задать желаемую структуру.

```
Найди  в тексте географические адреса и разбей их на отдельные компоненты. Ответ дай в формате {"address":{"street":"street name","house_number":"house number","room":"room","city":"city name","postal_code":"postal code","region":"region name","country":"country name"}}

<sample_text>
```

Теперь осталось только нужное!

```json
{
  "address": {
    "street": "ул. Чехова",
    "house_number": "2",
    "room": "ауд. И-201",
    "city": "Таганрог",
    "postal_code": "347922",
    "region": "Ростовская область",
    "country": "Россия"
  }
}
```

Стоит отметить, что иногда GPT выдает несуразный мапинг для адресов. Так что придется делать какой-то санитайзер, чтобы отбрасывать лишнее.

## Товары

На мой взгляд это самый интересный кейс. Чеки, акты и прочие документы, где может встречаться перечисление каких-то товаров или услуг с их параметрами.

Для проверки этого кейса я взял другой семпл текста. Данный семпл есть описание товара на одной из музыкальных барахолок.

```
Нижний Новгород / Пересыл

Возможно на хайгейновые педальки. Предлагайте вообщем, какую именно еще не определился.

Zephyr fx / 11к / Родная коробка
Родился пару месяцев назад. Понял ,определился. Нужны другие оверы.

Akai E2 Headrush Delay/Looper | 7к
Есть косметические дефекты по функционалу все ок.Улучшена кнопка переключения эффектов.
Липучка на дне

Vox 847 | 3k
Состояние хорошее. Но продавец с авито оказался подлецом. Давно это было. Я сразу не обратил внимание на такой нюанс как ход потца. Ощущение хода не очень,происходит провал в движении и только потом небольшое сапротивление. Да и кажется что эффект не до конца докручивается. Вариант для тех у кого есть свободный потенциометр.
```

Так же пробую дать волю нейронке и прошу дать ответ в свободной форме

```
Определи товары в тексте. Цену напиши в рублях. Ответ дай в формате json

<sample_text>
```

Ответ выглядит хорошо. Описание товаров она посчитала ненужным, цену дала в рублях как я и заказывал.

```json
{
  "товары": [
    {
      "название": "Zephyr fx",
      "цена": "11000 руб."
    },
    {
      "название": "Akai E2 Headrush Delay/Looper",
      "цена": "7000 руб."
    },
    {
      "название": "Vox 847",
      "цена": "3000 руб."
    }
  ]
}
```

Пробую вариант с конкретной структурой.

```
Определи товары в тексте. Цену напиши в рублях. Ответ дай в формате {"products":[{ "name":"product name", "price":"price", "description": "product description", "type": "product type" }]}

<sample_text>
```

Прэтти гуд! В поле type, в целом, попали правильные типы, но конкретики не много. Я пробовал втормы промтом конкретизировать тип эффектов, но особо качественне ответ не стал. Ах да, в поле price пропало название валюты. Последнее не сильно критично, но снова нужна постобработка.

```json
{
  "products": [
    {
      "name": "Zephyr fx",
      "price": "11000",
      "description": "Родная коробка. Родился пару месяцев назад. Понял, определился. Нужны другие оверы.",
      "type": "хайгейновые педальки"
    },
    {
      "name": "Akai E2 Headrush Delay/Looper",
      "price": "7000",
      "description": "Есть косметические дефекты, по функционалу все ок. Улучшена кнопка переключения эффектов. Липучка на дне.",
      "type": "эффекты"
    },
    {
      "name": "Vox 847",
      "price": "3000",
      "description": "Состояние хорошее. Ощущение хода не очень, происходит провал в движении и только потом небольшое сопротивление. Да и кажется, что эффект не до конца докручивается. Вариант для тех, у кого есть свободный потенциометр.",
      "type": "эффекты"
    }
  ]
}
```

## Вывод
